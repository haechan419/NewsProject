import FaceRegistration from './FaceRegistration';

const ProfileEditForm = ({
  user,
  nickname,
  onNicknameChange,
  selectedCategories,
  availableCategories,
  onCategoryToggle,
  validationErrors,
  successMessage,
  isSubmitting,
  isLoading,
  isAutoGeneratedNickname,
  onNicknameSubmit,
  onCategoriesSubmit,
  onCancel,
  // ì–¼êµ´ ë“±ë¡ ê´€ë ¨ props
  isCameraActive,
  isVideoReady,
  cameraError,
  isRegisteringFace,
  facePreview,
  faceMessage,
  videoRef,
  fileInputRef,
  onCameraToggle,
  onFaceImageSelect,
  onCapturePhoto,
  onStopCamera,
  onRegisterFace,
  onResetFace
}) => {
  return (
    <div className="profile-edit-container">
      <div className="profile-edit-box">
        <div className="profile-header">
          <h2 className="profile-edit-title">í”„ë¡œí•„ ìˆ˜ì •</h2>
          <p className="profile-subtitle">ê³„ì • ì •ë³´ì™€ ì–¼êµ´ ì¸ì‹ ì„¤ì •ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤</p>
        </div>
        
        {isAutoGeneratedNickname && (
          <div className="info-message">
            <div className="info-message-title">
              ğŸ’¡ ë‹‰ë„¤ì„ ì•ˆë‚´
            </div>
            <div className="info-message-content">
              í˜„ì¬ ë‹‰ë„¤ì„ì´ ìë™ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì›í•˜ëŠ” ë‹‰ë„¤ì„ìœ¼ë¡œ ë³€ê²½í•´ì£¼ì„¸ìš”.
            </div>
          </div>
        )}

        <div className="profile-edit-form">
          {/* ê¸°ë³¸ ì •ë³´ ì„¹ì…˜ */}
          <div className="form-section">
            <h3 className="section-title">ê¸°ë³¸ ì •ë³´</h3>
            
            <div className="form-group">
              <label htmlFor="email">ì´ë©”ì¼</label>
              <input
                type="email"
                id="email"
                value={user?.email || ''}
                disabled
                className="disabled-input"
                style={{ backgroundColor: '#f5f5f5', cursor: 'not-allowed' }}
              />
              <small style={{ color: '#666', fontSize: '12px', marginTop: '4px', display: 'block' }}>
                ì´ë©”ì¼ì€ ë³€ê²½í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.
              </small>
            </div>

            <div className="form-group">
              <label htmlFor="provider">ë¡œê·¸ì¸ ì œê³µì</label>
              <input
                type="text"
                id="provider"
                value={user?.provider === 'local' ? 'ì¼ë°˜ ë¡œê·¸ì¸' : 
                       user?.provider === 'kakao' ? 'ì¹´ì¹´ì˜¤' :
                       user?.provider === 'naver' ? 'ë„¤ì´ë²„' :
                       user?.provider === 'google' ? 'êµ¬ê¸€' : user?.provider || ''}
                disabled
                className="disabled-input"
                style={{ backgroundColor: '#f5f5f5', cursor: 'not-allowed' }}
              />
            </div>
          </div>

          {/* ë‹‰ë„¤ì„ ìˆ˜ì • ì„¹ì…˜ */}
          <div className="form-section">
            <h3 className="section-title">ë‹‰ë„¤ì„ ìˆ˜ì •</h3>
            <form onSubmit={onNicknameSubmit}>
              <div className="form-group">
                <label htmlFor="nickname">ë‹‰ë„¤ì„</label>
                <input
                  type="text"
                  id="nickname"
                  value={nickname}
                  onChange={onNicknameChange}
                  className={validationErrors.nickname ? 'error' : ''}
                  placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš” (2-20ì, í•œê¸€/ì˜ë¬¸/ìˆ«ì)"
                  disabled={isSubmitting || isLoading}
                  maxLength={20}
                />
                {validationErrors.nickname && (
                  <span className="error-message">{validationErrors.nickname}</span>
                )}
                <small style={{ color: '#666', fontSize: '12px', marginTop: '4px', display: 'block' }}>
                  í•œê¸€, ì˜ë¬¸, ìˆ«ìë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤. (2-20ì)
                </small>
              </div>
              <div className="button-group-inline">
                <button 
                  type="submit" 
                  className="submit-button" 
                  disabled={isSubmitting || isLoading}
                >
                  {isSubmitting ? 'ìˆ˜ì • ì¤‘...' : 'ë‹‰ë„¤ì„ ì €ì¥'}
                </button>
              </div>
            </form>
          </div>

          {/* ê´€ì‹¬ ì¹´í…Œê³ ë¦¬ ìˆ˜ì • ì„¹ì…˜ */}
          <div className="form-section">
            <h3 className="section-title">ê´€ì‹¬ ì¹´í…Œê³ ë¦¬ ìˆ˜ì •</h3>
            <form onSubmit={onCategoriesSubmit}>
              <div className="form-group">
                <label htmlFor="categories">
                  ê´€ì‹¬ ì¹´í…Œê³ ë¦¬ <span className="category-hint">(ìµœëŒ€ 3ê°œ ì„ íƒ ê°€ëŠ¥)</span>
                </label>
                <div className="category-selector">
                  {availableCategories.map((category) => {
                    const isSelected = selectedCategories.includes(category);
                    const isDisabled = !isSelected && selectedCategories.length >= 3;
                    return (
                      <button
                        key={category}
                        type="button"
                        className={`category-chip ${isSelected ? 'selected' : ''} ${isDisabled ? 'disabled' : ''}`}
                        onClick={() => onCategoryToggle(category)}
                        disabled={isSubmitting || isLoading || isDisabled}
                      >
                        {category}
                        {isSelected && <span className="check-icon">âœ“</span>}
                      </button>
                    );
                  })}
                </div>
                {validationErrors.categories && (
                  <span className="error-message">{validationErrors.categories}</span>
                )}
                {selectedCategories.length > 0 && (
                  <div className="category-selected-info">
                    ì„ íƒëœ ì¹´í…Œê³ ë¦¬: {selectedCategories.join(', ')} ({selectedCategories.length}/3)
                  </div>
                )}
              </div>
              <div className="button-group-inline">
                <button 
                  type="submit" 
                  className="submit-button" 
                  disabled={isSubmitting || isLoading}
                >
                  {isSubmitting ? 'ìˆ˜ì • ì¤‘...' : 'ì¹´í…Œê³ ë¦¬ ì €ì¥'}
                </button>
              </div>
            </form>
          </div>

          <FaceRegistration
            isCameraActive={isCameraActive}
            isVideoReady={isVideoReady}
            cameraError={cameraError}
            isRegisteringFace={isRegisteringFace}
            isLoading={isLoading}
            facePreview={facePreview}
            faceMessage={faceMessage}
            videoRef={videoRef}
            fileInputRef={fileInputRef}
            onCameraToggle={onCameraToggle}
            onFaceImageSelect={onFaceImageSelect}
            onCapturePhoto={onCapturePhoto}
            onStopCamera={onStopCamera}
            onRegisterFace={onRegisterFace}
            onResetFace={onResetFace}
          />

          {successMessage && (
            <div className="success-message" style={{ 
              textAlign: 'center', 
              padding: '10px', 
              backgroundColor: '#d4edda', 
              borderRadius: '6px', 
              border: '1px solid #c3e6cb',
              color: '#155724',
              marginBottom: '20px',
              marginTop: '20px'
            }}>
              {successMessage}
            </div>
          )}

          <div className="button-group">
            <button 
              type="button" 
              onClick={onCancel}
              className="cancel-button"
              disabled={isSubmitting || isLoading}
            >
              ì·¨ì†Œ
            </button>
          </div>
        </div>
      </div>
    </div>
  );
};

export default ProfileEditForm;
