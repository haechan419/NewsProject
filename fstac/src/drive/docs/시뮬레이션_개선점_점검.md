# 드라이브 모드 – 사용자 시뮬레이션 관점 개선점 점검

사용자/시연자 입장에서 시뮬레이션·데모를 돌릴 때 개선하면 좋은 점들을 정리한 문서입니다.

---

## 1. 적용 완료된 개선

### 1.1 testNoAudio 시 흐름 멈춤 해결 (VITE_TEST_NO_AUDIO=true)

- **문제**: 스피커 없이 시뮬레이션할 때 환영 멘트·브리핑 후 실제 재생이 없어 `onPlaybackEnd`가 호출되지 않고, 다음 뉴스로 넘어가지 않음.
- **조치**:
  - `useDriveAudio`에 `simulatePlaybackEnd()` 추가. 호출 시 `onPlaybackEnd(null, 0)` 실행.
  - 진입 시 `testNoAudio`이면 1.5초 후 `simulatePlaybackEnd()` 호출 → 환영 종료 처리 후 브리핑/다음 뉴스 흐름 진행.
  - NEW_BRIEFING 분기에서 `testNoAudio`이면 `pendingEntryDataRef` 정리 후 0.8초 뒤 `simulatePlaybackEnd()` 호출 → 브리핑 종료 처리 후 `playNextNews()` 스케줄.
- **결과**: 스피커 없이도 진입 → 환영 → 브리핑 → 다음 뉴스까지 시뮬레이션이 끊기지 않고 진행됨.

---

## 2. 추가로 검토하면 좋은 개선점

### 2.1 데모 모드(VITE_DEMO_VOICE) 안내 표시

- **현상**: 키보드 1~5로 명령을 선택하는 데모 모드인데, 화면에 “1~5 키로 명령 선택” 같은 안내가 없음.
- **제안**: 데모 모드일 때만 상태 메시지 아래 또는 컨트롤 근처에 짧은 힌트 표시.  
  예: `"1:다음 2:이어듣기 3:일시정지 4:재생 5:종료 (키보드로 선택 후 마이크 버튼)"`
- **우선순위**: 중 (시연 시 유용).

### 2.2 현재 선택된 데모 명령 표시

- **현상**: 1~5 키를 눌러도 “지금 어떤 명령이 선택됐는지” 화면에 안 나옴.
- **제안**: 데모 모드에서 `demoCommandKey`에 따라 작은 라벨 표시.  
  예: `"선택: 다음 (1)"` 또는 아이콘+숫자.
- **우선순위**: 낮음.

### 2.3 X 버튼 vs 종료 버튼 동작 차이

- **현상**: 상단 X는 `onClose`만 호출해 **서버에 `setDriveModeActive(false)`를 보내지 않음**.  
  “종료” 버튼은 `stopDriveMode()` → `setDriveModeActive(false)` 호출.
- **영향**: X로만 나가면 서버는 드라이브 모드가 계속 켜져 있다고 생각할 수 있고, 재진입 시 이어듣기/세션 판단에 영향을 줄 수 있음.
- **제안**:
  - 옵션 A: X 클릭 시에도 `stopDriveMode()`를 먼저 호출한 뒤 `onClose()` (정식 종료 후 닫기).
  - 옵션 B: 그대로 두고, “시연 시에는 가능한 종료 버튼으로 나가기” 등으로 시나리오 가이드에 명시.
- **우선순위**: 중 (시연/테스트 시나리오에 따라 결정).

### 2.4 이어듣기 선택 10초 타임아웃 안내

- **현상**: “이전에 듣던 뉴스를 이어서 들을까요?” 후 10초 안에 선택하지 않으면 자동 이어듣기/다음 뉴스로 넘어감. 남은 시간이 화면에 안 나옴.
- **제안**: “10초 후 자동으로 이어듣기를 시작합니다” 또는 “(8초 후 자동 진행)” 같은 문구, 또는 짧은 카운트다운(선택).
- **우선순위**: 낮음.

### 2.5 진입 실패 시 재시도 안내

- **현상**: 네트워크 오류로 진입 실패 시 “네트워크 연결을 확인 중입니다...”만 보이고, **몇 초 후 재시도인지·몇 회째인지** 안 나옴.
- **제안**:  
  예: `"2초 후 재시도 (1/3)"` / `"재시도 2/3..."`  
  재시도 소진 시: `"연결에 실패했습니다. 네트워크를 확인한 뒤 다시 시도해주세요."`
- **우선순위**: 중.

### 2.6 큐 비어 있을 때(모든 뉴스 재생 완료)

- **현상**: “모든 뉴스를 재생했습니다” + QUEUE_EMPTY 멘트 후, 재생 버튼을 다시 누르면 `playNextNews()`만 호출되어 큐가 비어 있으므로 같은 멘트만 반복됨.
- **제안**:
  - 재생 버튼: 큐가 비어 있을 때는 “히스토리에서 다시 들을 수 있습니다” 안내 후 `playNextNews()` 대신 히스토리 패널 강조 또는 아무 동작 안 함.
  - 또는 “다시 들으시려면 히스토리에서 선택해주세요” 문구를 상태 메시지로 유지.
- **우선순위**: 중.

### 2.7 음성 명령 실패 메시지 유지 시간

- **현상**: “조금 더 길게 말씀해주세요” 등이 2초 뒤 사라져서, 읽기 전에 없어질 수 있음.
- **제안**: 2.5~3초로 늘리거나, 사용자가 버튼을 한 번 누르면 사라지게 하는 방식 검토.
- **우선순위**: 낮음.

### 2.8 히스토리 로드 실패 안내

- **현상**: `loadHistory()` 실패 시 `setHistory([])`만 하고, 사용자에게 “불러오기 실패”를 알리지 않음.
- **제안**: 실패 시 상태 메시지 또는 토스트로 “히스토리를 불러올 수 없습니다” 한 번 표시.
- **우선순위**: 낮음.

### 2.9 자동 재생 정책(첫 클릭) 후 재생

- **현상**: “재생을 위해 화면을 한 번 클릭해주세요” 후 사용자가 클릭해도, **어디를 클릭해야 재생이 시작되는지**가 직관적이지 않을 수 있음.
- **제안**: 해당 메시지 표시 시 재생 버튼을 강조하거나, 메시지 옆에 “재생 버튼을 눌러주세요” 보조 문구 추가.
- **우선순위**: 낮음.

### 2.10 TTS/연결 반복 실패 시 안내

- **현상**: TTS 또는 연결 실패가 3회 반복되면 에러 메시지로 전환되지만, “잠시 후 다시 시도해보세요” 등 다음 행동이 드러나지 않을 수 있음.
- **제안**:  
  예: `"뉴스 재생에 문제가 발생했습니다. 네트워크와 서버를 확인한 뒤 재생 버튼을 다시 눌러주세요."`
- **우선순위**: 낮음.

---

## 3. 시뮬레이션 시나리오별 체크리스트

| 시나리오 | 확인할 점 |
|----------|------------|
| **첫 진입 (NEW_BRIEFING / FIRST_TIME_WELCOME)** | 환영 → 브리핑(또는 바로 뉴스) → 첫 뉴스 재생 순서가 끊기지 않는지 |
| **재진입 (RESUME_BRIEFING)** | 이어듣기 안내 → 10초 내 선택 / 타임아웃 후 자동 이어듣기 또는 다음 뉴스 동작 |
| **VITE_TEST_NO_AUDIO=true** | 진입·브리핑 후 자동으로 다음 뉴스로 진행하는지, `simulatePlaybackEnd` 동작 여부 |
| **VITE_DEMO_VOICE=true** | 1~5 키 선택 후 마이크 버튼으로 명령 실행, 데모 MP3 기반 응답 |
| **마이크 없음 → 데모 폴백** | “마이크를 찾을 수 없습니다” 대신 데모 모드로 전환되는지 |
| **탭 이탈 후 재진입** | 이전 타이머/명령이 실행되지 않고, 새 세션으로만 동작하는지 (`isMountedRef` 등) |
| **X로 닫기 vs 종료 버튼** | 서버 세션 정리 여부 차이 인지 및, 필요 시 X에서도 정식 종료 호출 검토 |

---

## 4. 환경 변수 요약 (시뮬레이션용)

| 변수 | 용도 |
|------|------|
| `VITE_TEST_NO_AUDIO=true` | 스피커 없이 시뮬레이션 (재생은 시간만 시뮬레이션, 흐름은 `simulatePlaybackEnd`로 진행) |
| `VITE_TEST_NO_MICROPHONE=true` | 마이크 없음 시뮬레이션 |
| `VITE_DEMO_VOICE=true` | 데모 MP3 기반 음성 명령 (키보드 1~5 + 마이크 버튼) |

위 문서는 `DriveModePage.jsx`, `useDriveAudio.js`, `BentoGridHUD.jsx` 기준으로 작성되었으며, 필요 시 라인 번호는 최신 코드에 맞춰 갱신하면 됩니다.
