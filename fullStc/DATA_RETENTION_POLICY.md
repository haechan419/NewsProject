# 데이터 보관 및 삭제 정책

## 1. 개요

본 문서는 서비스에서 수집하는 개인정보 및 데이터의 보관, 삭제 정책을 명시합니다.

## 2. 회원 데이터 보관 정책

### 2.1 활성 회원 데이터
- **보관 기간**: 회원 탈퇴 시까지 무기한 보관
- **보관 데이터**:
  - 회원 기본 정보 (이메일, 닉네임, 이름)
  - 비밀번호 (BCrypt 암호화)
  - 프로필 이미지
  - 얼굴 인식 데이터
  - 관심 카테고리 정보
  - 작성한 게시글 및 댓글

### 2.2 탈퇴 회원 데이터
- **삭제 시점**: 회원 탈퇴 즉시
- **삭제 대상**:
  - 회원 기본 정보 (소프트 삭제: enabled=false)
  - 얼굴 인식 데이터 (DB 및 파일 시스템에서 완전 삭제)
  - 프로필 이미지 (원본 및 썸네일 완전 삭제)
  - 리프레시 토큰
- **보관 데이터**:
  - 법령에 따라 보관이 필요한 경우 해당 기간 동안 별도 보관

## 3. 얼굴 인식 데이터 처리

### 3.1 데이터 저장 위치
1. **데이터베이스 (MySQL)**
   - 테이블: `face`
   - 저장 내용: 얼굴 이미지 Base64, 얼굴 특징 설명, 품질 정보
   
2. **Python AI 서버 파일 시스템**
   - 경로: `python-ai/face_data/{user_email}/`
   - 저장 내용: 얼굴 이미지 파일 (JPG)

### 3.2 삭제 프로세스
회원 탈퇴 시 다음 순서로 삭제됩니다:

1. **DB 삭제**
   ```sql
   DELETE FROM face WHERE member_id = ?
   ```

2. **Python 서버 파일 삭제**
   ```http
   DELETE /face/{user_email}
   ```

3. **삭제 실패 처리**
   - Python 서버 삭제 실패 시에도 회원 탈퇴는 정상 처리
   - 오류 로그 기록 후 계속 진행

### 3.3 보안 조치
- Base64 인코딩된 이미지 데이터만 저장
- 파일 시스템 접근 권한 제한
- HTTPS를 통한 안전한 전송

## 4. 프로필 이미지 처리

### 4.1 저장 위치
- 경로: `fullStc/upload/`
- 원본 이미지: `{UUID}.{확장자}`
- 썸네일 이미지: `thumbnails/s_{UUID}.{확장자}`

### 4.2 삭제 프로세스
회원 탈퇴 또는 프로필 이미지 변경 시:

1. 원본 파일 삭제
2. 썸네일 파일 삭제
3. DB 레코드 삭제

### 4.3 삭제 실패 처리
- 파일 삭제 실패 시에도 DB 레코드는 삭제
- 오류 로그 기록
- 주기적인 고아 파일 정리 필요 (수동 또는 스케줄러)

## 5. 로그 데이터 보관 정책

### 5.1 애플리케이션 로그
- **저장 위치**: `fullStc/logs/`
- **파일명 형식**: `application-{날짜}.{인덱스}.log`
- **보관 기간**: 30일
- **파일 크기 제한**: 
  - 개별 파일: 최대 10MB
  - 전체 로그: 최대 1GB
- **로테이션 정책**: 
  - 일별 로테이션
  - 크기 초과 시 자동 분할

### 5.2 로그 내용
- 애플리케이션 실행 로그
- API 요청/응답 로그
- 에러 및 예외 로그
- 보안 관련 이벤트 로그

### 5.3 로그 보안
- 개인정보(비밀번호, 토큰 등)는 로그에 기록하지 않음
- 이메일 주소는 마스킹 처리 권장
- 로그 파일 접근 권한 제한

## 6. 게시판 데이터

### 6.1 게시글 및 댓글
- **보관 기간**: 작성자가 삭제하거나 관리자가 삭제할 때까지
- **탈퇴 회원의 게시글**: 
  - 작성자 정보는 "탈퇴한 회원"으로 표시
  - 게시글 내용은 유지 (서비스 연속성 보장)

### 6.2 첨부 파일
- 게시글 삭제 시 함께 삭제
- 파일 저장 위치: `fullStc/upload/`

## 7. 세션 및 토큰 데이터

### 7.1 액세스 토큰 (JWT)
- **유효 기간**: 1시간
- **저장 위치**: 클라이언트 메모리 (Redux store)
- **만료 처리**: 자동 만료 (서버 검증)

### 7.2 리프레시 토큰
- **유효 기간**: 7일
- **저장 위치**: 
  - 서버: MySQL `refresh_token` 테이블
  - 클라이언트: HttpOnly 쿠키
- **삭제 시점**:
  - 로그아웃 시
  - 회원 탈퇴 시
  - 토큰 만료 시

## 8. 캐시 데이터

### 8.1 Redis 캐시
- **저장 데이터**: 
  - 시장 데이터 (환율, 주가 지수)
  - API 응답 캐시
- **TTL (Time To Live)**: 
  - 시장 데이터: 15초
  - 기타 캐시: 설정에 따라 다름
- **삭제**: TTL 만료 시 자동 삭제

## 9. 백업 정책

### 9.1 데이터베이스 백업
- **백업 주기**: 일일 백업 권장
- **보관 기간**: 최소 7일
- **백업 위치**: 별도의 안전한 저장소

### 9.2 파일 시스템 백업
- **백업 대상**: 
  - 업로드 파일 (`upload/`)
  - 얼굴 인식 데이터 (`face_data/`)
- **백업 주기**: 주간 백업 권장
- **보관 기간**: 최소 30일

## 10. 법적 보관 의무

### 10.1 전자상거래 등에서의 소비자보호에 관한 법률
- 계약 또는 청약철회 등에 관한 기록: **5년**
- 대금결제 및 재화 등의 공급에 관한 기록: **5년**
- 소비자의 불만 또는 분쟁처리에 관한 기록: **3년**

### 10.2 통신비밀보호법
- 웹사이트 방문 기록: **3개월**

### 10.3 전자금융거래법
- 전자금융거래에 관한 기록: **5년**

## 11. 데이터 삭제 방법

### 11.1 데이터베이스
- 소프트 삭제: `enabled` 플래그를 `false`로 설정
- 하드 삭제: `DELETE` 쿼리 실행

### 11.2 파일 시스템
- 물리적 파일 삭제
- 복구 불가능한 방식으로 삭제

### 11.3 로그
- 로테이션 정책에 따라 자동 삭제
- 보관 기간 경과 시 자동 삭제

## 12. 정기 점검

### 12.1 데이터 정리
- **주기**: 월 1회
- **점검 항목**:
  - 고아 파일 (DB에 레코드 없는 파일)
  - 만료된 토큰
  - 오래된 로그 파일

### 12.2 보안 점검
- **주기**: 분기 1회
- **점검 항목**:
  - 접근 권한 검토
  - 암호화 상태 확인
  - 로그 분석

## 13. 책임 및 연락처

- **데이터 관리 책임자**: 개발팀
- **문의**: [이메일 주소]

---

**최종 업데이트: 2026년 2월 2일**
